# PaytmLabs
Assignment from Paytm interview

### Step 1 - Setting Up the Data
#### [x] 1. Load the global weather data into your big data technology of choice.
```
weather = spark.read.load(
    "/Users/xzhang/Downloads/paytmteam-de-weather-challenge-b01d5ebbf02d/data/2019/part-00000-890686c0-c142-4c69-a744-dfdc9eca7df4-c000.csv.gz",
    format="com.databricks.spark.csv",
    header="true",
    inferSchema="true",
)
```
##### result:
```
>>> weather.show(10)
+------+-----+--------+----+----+------+------+-----+----+-----+----+-----+-----+-----+-----+------+
|STN_NO| WBAN|YEARMODA|TEMP|DEWP|   SLP|   STP|VISIB|WDSP|MXSPD|GUST|  MAX|  MIN| PRCP| SNDP|FRSHTT|
+------+-----+--------+----+----+------+------+-----+----+-----+----+-----+-----+-----+-----+------+
| 10260|99999|20190101|26.1|21.2|1001.9| 987.5| 20.6| 9.0| 15.9|29.7| 29.8|21.7*|0.02G| 18.5|  1000|
| 10260|99999|20190102|24.9|22.1|1020.1|1005.5|  5.4| 5.6| 13.6|22.1|27.1*| 20.7|0.48G| 22.8|  1000|
| 10260|99999|20190103|31.7|29.1|1008.9| 994.7| 13.6|11.6| 21.4|49.5|37.4*|26.8*|0.25G|999.9| 11000|
| 10260|99999|20190104|32.9|30.3|1011.4| 997.1| 15.8| 4.9|  7.8|10.9| 36.1| 31.8|0.52G|999.9|  1000|
| 10260|99999|20190105|35.5|33.0|1015.7|1001.4| 12.0|10.4| 13.6|21.0|38.5*| 32.7|0.02G| 23.6| 10000|
| 10260|99999|20190106|38.5|34.1|1008.2| 994.2| 12.8|10.0| 17.5|28.9| 41.4|33.8*|0.12G| 23.2| 10000|
| 10260|99999|20190107|32.1|29.8| 996.8| 982.7|  6.9|11.3| 15.5|28.6|35.1*| 30.4|0.00G|999.9|  1000|
| 10260|99999|20190108|31.6|28.0| 997.4| 983.3| 22.9| 5.9| 11.7|19.0| 34.3|28.0*|0.53G|  0.4| 11000|
| 10260|99999|20190109|29.9|27.7|1011.6| 997.3| 29.8| 7.6| 15.2|26.6| 32.4| 26.1|0.20G| 23.6|  1000|
| 10260|99999|20190110|33.1|30.6| 979.1| 965.3|  5.3|17.8| 24.9|41.8| 41.4|28.8*|0.00G|999.9| 11000|
+------+-----+--------+----+----+------+------+-----+----+-----+----+-----+-----+-----+-----+------+
only showing top 10 rows
```

#### [x] 2. Join the stationlist.csv with the countrylist.csv to get the full country name for each station number.
```
country = spark.read.load(
    "/Users/xzhang/Downloads/paytmteam-de-weather-challenge-b01d5ebbf02d/countrylist.csv",
    format="com.databricks.spark.csv",
    header="true",
    inferSchema="true",
)
station = spark.read.load(
    "/Users/xzhang/Downloads/paytmteam-de-weather-challenge-b01d5ebbf02d/stationlist.csv",
    format="com.databricks.spark.csv",
    header="true",
    inferSchema="true",
)
fullname = country.join(station, on="COUNTRY_ABBR")
```
##### result:
```
>>> fullname.show(10)
+------------+--------------+------+
|COUNTRY_ABBR|  COUNTRY_FULL|STN_NO|
+------------+--------------+------+
|          NO|        NORWAY|012240|
|          SW|        SWEDEN|020690|
|          SW|        SWEDEN|020870|
|          SW|        SWEDEN|021190|
|          UK|UNITED KINGDOM|032690|
|          UK|UNITED KINGDOM|033450|
|          UK|UNITED KINGDOM|039290|
|          EI|       IRELAND|039790|
|          IC|       ICELAND|040480|
|          IC|       ICELAND|041300|
+------------+--------------+------+
only showing top 10 rows
```

#### [x] 3. Join the global weather data with the full country names by station number.
```
weather = weather.withColumnRenamed("STN---", "STN_NO")
fullweather = fullname.join(weather, on="STN_NO")
```
##### result:
```
>>> fullweather.show(10)
+------+------------+------------+-----+--------+----+----+------+-----+-----+----+-----+----+-----+-----+-----+-----+------+
|STN_NO|COUNTRY_ABBR|COUNTRY_FULL| WBAN|YEARMODA|TEMP|DEWP|   SLP|  STP|VISIB|WDSP|MXSPD|GUST|  MAX|  MIN| PRCP| SNDP|FRSHTT|
+------+------------+------------+-----+--------+----+----+------+-----+-----+----+-----+----+-----+-----+-----+-----+------+
|028170|          FI|     FINLAND|99999|20190101|15.7|13.9| 995.4|940.6|999.9|17.5| 26.8|33.0| 19.9|11.5*|0.00I|999.9|     0|
|028170|          FI|     FINLAND|99999|20190102| 9.7| 7.2|1017.0|960.3|999.9|13.9| 17.3|21.2| 16.0|  7.9|0.00I|999.9|     0|
|028170|          FI|     FINLAND|99999|20190103| 9.0| 6.5|1014.9|958.3|999.9|17.1| 26.8|34.2|15.4*|  1.6|0.00I|999.9|     0|
|028170|          FI|     FINLAND|99999|20190104|21.5|20.4|1008.9|954.0|999.9|11.0| 15.2|18.1|25.9*| 12.4|0.00I|999.9|     0|
|028170|          FI|     FINLAND|99999|20190105|20.5|19.2|1015.4|960.0|999.9| 9.3| 12.8|15.9| 26.4|14.9*|0.00I|999.9|     0|
|028170|          FI|     FINLAND|99999|20190106|24.1|23.3|1007.4|952.9|999.9|13.5| 17.1|21.8|32.0*| 14.9|0.00I|999.9|     0|
|028170|          FI|     FINLAND|99999|20190107|20.8|19.6| 999.5|945.0|999.9|12.5| 14.4|17.5| 32.0|15.8*|0.00I|999.9|     0|
|028170|          FI|     FINLAND|99999|20190108|13.1|11.0| 997.6|942.4|999.9|11.3| 15.7|19.8| 18.7|10.4*|0.00I|999.9|     0|
|028170|          FI|     FINLAND|99999|20190109| 8.4| 5.7|1013.5|956.8|999.9|10.1| 17.1|19.4| 14.0| 3.2*|0.00I|999.9|     0|
|028170|          FI|     FINLAND|99999|20190110|15.6|13.9| 991.5|936.9|999.9|26.7| 39.8|54.4|27.1*|  3.2|0.00I|999.9|     0|
+------+------------+------------+-----+--------+----+----+------+-----+-----+----+-----+----+-----+-----+-----+-----+------+
only showing top 10 rows
```
### Step 2 - Questions
#### [x] 1. Which country had the hottest average mean temperature over the year?
```
avg_weather = fullweather.groupBy("COUNTRY_FULL").avg()
hotest_country = avg_weather.sort("avg(TEMP)", ascending=False).limit(1)
```
##### result:
```
>>> hotest_country.show()
+------------+---------+-------------------+-----------------+-----------------+------------------+------------------+-----------------+-----------------+------------------+-----------------+-----------------+-----------------+
|COUNTRY_FULL|avg(WBAN)|      avg(YEARMODA)|        avg(TEMP)|        avg(DEWP)|          avg(SLP)|          avg(STP)|       avg(VISIB)|        avg(WDSP)|        avg(MXSPD)|        avg(GUST)|        avg(SNDP)|      avg(FRSHTT)|
+------------+---------+-------------------+-----------------+-----------------+------------------+------------------+-----------------+-----------------+------------------+-----------------+-----------------+-----------------+
|       NIGER|  99999.0|2.019066832328767E7|86.55643835616438|46.37301369863014|1058.8828767123289|1012.7310958904112|6.757808219178072|8.014657534246572|13.574931506849321|999.9000000000036|999.9000000000036|960.5342465753424|
+------------+---------+-------------------+-----------------+-----------------+------------------+------------------+-----------------+-----------------+------------------+-----------------+-----------------+-----------------+
```

#### [x] 2. Which country had the coldest average mean temperature over the year?
```coldest_country = avg_weather.sort("avg(TEMP)", ascending=True).limit(1)```
##### result:
```
>>> coldest_country.show()
+------------+-----------------+-------------------+------------------+------------------+------------------+------------------+------------------+------------------+------------------+-----------------+-----------------+------------------+
|COUNTRY_FULL|        avg(WBAN)|      avg(YEARMODA)|         avg(TEMP)|         avg(DEWP)|          avg(SLP)|          avg(STP)|        avg(VISIB)|         avg(WDSP)|        avg(MXSPD)|        avg(GUST)|        avg(SNDP)|       avg(FRSHTT)|
+------------+-----------------+-------------------+------------------+------------------+------------------+------------------+------------------+------------------+------------------+-----------------+-----------------+------------------+
|  ANTARCTICA|98962.26330338631|2.019066845173923E7|13.383874683252705|13.268624740843117|1020.8533287261001|1031.9185210780925|254.87111264685637|15.248283805574749|23.692997005298327|827.4145818935749|779.7188896567623|13471.227827689472|
+------------+-----------------+-------------------+------------------+------------------+------------------+------------------+------------------+------------------+------------------+-----------------+-----------------+------------------+
```

#### [x] 3. Which country had the second highest average mean wind speed over the year?
```
windy_country = avg_weather.sort("avg(WDSP)", ascending=False).limit(2)
second_windy_country = windy_country.sort("avg(WDSP)", ascending=True).limit(1)
```
##### result:
```
>>> second_windy_country.show()
+------------+---------+-------------------+------------------+------------------+------------------+-----------------+------------------+------------------+-----------------+-----------------+-----------------+------------------+
|COUNTRY_FULL|avg(WBAN)|      avg(YEARMODA)|         avg(TEMP)|         avg(DEWP)|          avg(SLP)|         avg(STP)|        avg(VISIB)|         avg(WDSP)|       avg(MXSPD)|        avg(GUST)|        avg(SNDP)|       avg(FRSHTT)|
+------------+---------+-------------------+------------------+------------------+------------------+-----------------+------------------+------------------+-----------------+-----------------+-----------------+------------------+
|    MONGOLIA|  99999.0|2.019066832328767E7|30.817328767123296|13.609520547945204|1030.8568835616443|846.5146917808219|179.21780821917793|60.163150684931566|64.57414383561645|999.9000000000036|700.8110273972586|2904.9075342465753|
+------------+---------+-------------------+------------------+------------------+------------------+-----------------+------------------+------------------+-----------------+-----------------+-----------------+------------------+
```

#### [x] 4. Which country had the most consecutive days of tornadoes/funnel cloud formations?
```
tfc_days = fullweather.filter(fullweather['FRSHTT']%2 ==1)
most_tornado_country = tfc_days.select(tfc_days['COUNTRY_FULL']).groupBy('COUNTRY_FULL').count().sort('count', ascending=False).limit(1)
```
##### result:
```
>>> most_tornado_country.show()
+-------------+-----+
| COUNTRY_FULL|count|
+-------------+-----+
|UNITED STATES|    8|
+-------------+-----+
```
